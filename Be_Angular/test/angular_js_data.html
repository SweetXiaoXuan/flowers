<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="https://cdn.staticfile.org/angular.js/1.6.3/angular.min.js"></script>
</head>
<body>
<div ng-app="myApp">
    <div ng-controller="firstController">
        <div book-list></div>
    </div>
</div>
</body>
<script src="../js/jquery-1.7.1.min.js"></script>

<script >
    angular.module('myApp',[])
        .directive('bookList',function(){
            return {
                restrict:'ECAM',
                //此处定义了该指令的controller属性
                controller:function($scope){
                    // var result = null;
                    // $scope.names=null;
                    // $.get("http://localhost:17900/flower/flowers?flowerName")
                    //     .then(function (data) {
                    //         $scope.names =  data;
                    //         // $scope.names = result.body;
                    //         // console.info(JSON.stringify($scope.names));
                    // });

                        $.ajax({
                            url: "http://localhost:17900/flower/flowers?flowerName",
                            type: 'get',
                            dataType: 'json',
                            timeout: 1000,
                            success: function (data, status) {
                                localStorage.setItem("data", JSON.stringify(data));
                                $scope.names = localStorage.getItem("data");
                            }
                        });
                        // debugger
                    // var result = localStorage.getItem("data");
                    //     console.info("2"+JSON.stringify(result))
                    // $scope.names = result;

                    console.info("3"+JSON.stringify($scope.names));
                    // $scope.books=[
                    //     {name:'php'},
                    //     {name:'javascript'},
                    //     {name:'java'}
                    // ];

                    this.addBook=function(){       //或者 scope.addBook=...
                        alert('test');
                    }
                },
                controllerAs:'bookListController', //给当前controller起个名称
                template:'<ul><li ng-repeat="book in names">{{ book.flowerName }}</li></ul>',
                replace:true,
                //link中注入 bookListController ，就可以使用它的方法了
                link:function(scope,iElement,iAttrs,bookListController){
                    iElement.on('click',bookListController.addBook);
                }
            }
        })
        .controller('firstController',['$scope',function($scope){
            $.ajax({
                url: "http://localhost:17900/flower/flowers?flowerName",
                type: 'get',
                dataType: 'json',
                timeout: 1000,
                success: function (data, status) {
                    localStorage.setItem("data", JSON.stringify(data));
                    $scope.names = localStorage.getItem("data");
                }
            });
        }])
</script>
</html>