<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="../assets/layui/css/layui.css">
    <link rel="stylesheet" href="../assets/css/view.css"/>
    <title></title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../assets/css/login.css">
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="../assets/laydate/laydate.js"></script> <!-- 改成你的路径 -->
    <script src="../js/console.js"></script>
    <style type="text/css" >
        /*#switchTpl{overflow:visible;}*/

        td[data-field='status'] .layui-table-cell{
            overflow: visible;

        }
        .layui-table-body{
            overflow: visible;
        }
        .layui-table-box,.layui-table-view{
            overflow: visible;
        }

    </style>
    <link rel="icon" href="/favicon.ico">
</head>
<body class="layui-view-body">
<div class="layui-content">
    <div class="layui-row layui-col-space20">
        <div class="layui-col-sm6 layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-body chart-card">
                    <div class="chart-header">
                        <div class="metawrap">
                            <div class="meta">
                                <span  style="font-size: 18px;">佣金总额</span>
                            </div>
                            <div class="total all" style="height: 100px; margin-top: 20px">0.00元</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-sm6 layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-body chart-card">
                    <div class="chart-header">
                        <div class="metawrap">
                            <div class="meta">
                                <span style="font-size: 18px;">已提取佣金</span>
                            </div>
                            <div class="total already" style="height: 100px; margin-top: 20px">0.00元</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-sm6 layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-body chart-card">
                    <div class="chart-header">
                        <div class="metawrap">
                            <div class="meta">
                                <span style="font-size: 18px;">可提取佣金</span>
                            </div>
                            <div class="total can" style="height: 100px; margin-top: 20px">0.00元</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-sm6 layui-col-md3">
            <div class="meta" style="margin: 50px 0px 0px 80px; color: #1E9FFF">
                <button type="button" class="login-button" style="font-size: 24px; height: 50px; width: 150px;" onclick="withdraw()">佣金提取<i class="ai ai-enter"></i></button>
            </div>
        </div>
    </div>
</div>
<script src="../assets/layui/layui.all.js"></script>
<script>
    var element = layui.element;
    function withdraw() {
        window.location.href ="../views/withdraw.html";
    }
</script>



<div class="layui-content">
    <div class="layui-row">
        <div class="layui-card">
            <div class="layui-card-body">
                <div class="form-box">
                    <div class="layui-form layui-form-item">
                        <div class="layui-inline">
                            <div class="layui-form-mid">开始时间:</div>
                            <div class="layui-input-inline" style="width: 150px;">
                                <input type="text" autocomplete="off" class="layui-input" id="start" placeholder="yyyy-MM-dd">
                            </div>

                            <div class="layui-form-mid">结束时间:</div>
                            <div class="layui-input-inline" style="width: 150px;">
                                <input type="text" autocomplete="off" class="layui-input" id="end" placeholder="yyyy-MM-dd">
                            </div>

                            <div class="layui-form-mid">提取方式:</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <select name="extract" id="extract">
                                    <option value=""></option>
                                    <option value="0">支付宝</option>
                                    <option value="1">微信</option>
                                    <option value="2">银联</option>
                                </select>
                            </div>
                            <div class="layui-form-mid">申请状态:</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <select name="status" id="status">
                                    <option value=""></option>
                                    <option value="0">待审核</option>
                                    <option value="1">已提取</option>
                                    <option value="2">未通过</option>
                                </select>
                            </div>
                            <button class="layui-btn layui-btn-blue query">查询</button>
                            <button class="layui-btn layui-btn-primary" onclick="nameClean()">重置</button>
                        </div>

                    </div>
                    <table id="demo" lay-filter="demoEvent"> </table>

                    <script type="text/html" id="barDemo">
                        <button class="layui-btn layui-btn-xs withdrawUpdate" id="withdrawUpdate" lay-event="edit" >编辑</button>
                    </script>


                    <script type="text/xml" id="switchTpl" >

                        <div class="layui-input-inline" style="width: 100px;">
                            <script src="../assets/layui/layui.all.js"/>
                            <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"/>
                            <script src="../assets/layui/layui.all.js"/>

                    <select name="extract" id="extract">
                                <option value=""></option>
                                <option value="0">支付宝</option>
                                <option value="1">微信</option>
                                <option value="2">银联</option>
                            </select>
                            <div class="layui-unselect layui-form-select layui-form-selected layui-form-selectup">
                                <div class="layui-select-title">
                                    <input type="text" placeholder="请选择" value="" readonly="" class="layui-input layui-unselect"/>
                                    <i class="layui-edge"></i>
                                </div>
                                <dl class="layui-anim layui-anim-upbit" style="">
                                    <dd lay-value="" class="layui-select-tips layui-this">请选择</dd>
                                    <dd lay-value="0" class="">支付宝</dd>
                                    <dd lay-value="1" class="">微信</dd>
                                    <dd lay-value="2" class="">银联</dd>
                                </dl>
                            </div>
                        </div>


                    <!--<select name="city" lay-verify="required" id="statusSelect">-->
                            <!--<option value=""></option>-->
                            <!--<option value="0">待审核</option>-->
                            <!--<option value="1">已提取</option>-->
                            <!--<option value="2">未通过</option>-->
                        <!--</select>-->
                    <!--<div class="layui-form layui-form-item">-->
                        <!--<div class="layui-inline">-->
                        <!--<div class="layui-input-inline" style="width: 100%; padding: 0 10px;box-sizing: border-box;margin-top: 5px;">-->
                            <!--<select name="extract" id="type" style="width: 100%;height: 40px;">-->
                                <!--<option value=""></option>-->
                                <!--<option value="0">支付宝</option>-->
                                <!--<option value="1">微信</option>-->
                                <!--<option value="2">银联</option>-->
                            <!--</select>-->
                        <!--</div></div></div>-->
                        <!--<div class="layui-form layui-form-item">-->
                            <!--<div class="layui-inline">-->
                                <!--<div class="layui-input-inline" style="width: 100%; padding: 0 10px;box-sizing: border-box;margin-top: 5px;">-->
                                    <!--<select name="status" id="status" style="width: 100%;height: 40px;">-->
                                      <!--<option value=""></option>-->
                                        <!--<option value="0">待审核</option>-->
                                        <!--<option value="1">已提取</option>-->
                                        <!--<option value="2">未通过</option>-->
                                    <!--</select>-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/layui/layui.all.js"></script>
<script>
    function nameClean() {
        $('#start').val('');
        $('#end').val('');
        $('#extract').val('');
        $('#status').val('');
        $('#type').val('');
    }

    var level = localStorage.getItem("level");

    laydate.render({
        elem: '#start'
        ,showBottom: false
    });
    laydate.render({
        elem: '#end'
        ,showBottom: false
    });
    var datagrid;
    layui.use('table', function() {
        var element = layui.element;
        var table = layui.table;
        var form = layui.form;
        datagrid = {
            elem: '#demo'
            , where: {"rsid": localStorage.getItem("rsid")}
            , width: 1100
            // , url: 'http://localhost:8119/merchant/withdrawList'
            , url: 'http://47.98.40.106:8119/merchant/withdrawList'
            , parseData: function (res) {
                return {
                    "code": res.status,
                    "msg": res.msg,
                    "count": res.count,
                    "data": res.body.item
                };
            }
            , dataType: "json"
            , cols: [[
                // {type: 'checkbox', fixed: 'left'}
                {field: 'id', title: 'ID', sort: true}
                , {field: 'price', title: '提取金额'}
                , {field: 'extract', title: '提取方式'}
                , {field: 'account', title: '提取账号'}
                , {field: 'arrival', title: '到账方式'}
                , {field: 'insertTime', title: '提取时间'}
                , {field: 'remarks', title: '备注'}
                , {field: 'status', title: '申请状态', /* templet: '#switchTpl',*/ unresize: true}
                , {field: 'merchantName', title: '商户名'}
            ]]
            , done: function (res, curr, count) {
                var status = res.code;
                if (status === '10000') {
                    parent.location.href = "../login.html";
                }
                $("[data-field='extract']").children().each(function () {
                    if ($(this).text() == '0') {
                        $(this).text("支付宝")
                    } else if ($(this).text() == '1') {
                        $(this).text("微信")
                    } else if ($(this).text() == '2') {
                        $(this).text("银联")
                    }
                })
                $("[data-field='arrival']").children().each(function () {
                    if ($(this).text() == '0') {
                        $(this).text("快速到账")
                    } else if ($(this).text() == '1') {
                        $(this).text("正常到账")
                    }
                })
                $("[data-field='status']").children().each(function () {
                    if ($(this).text() == '0') {
                        $(this).text("待审核")
                        // $("#statusSelect option[value='0']").attr('selected', true);
                    } else if ($(this).text() == '1') {
                        $(this).text("已提取")
                    } else if ($(this).text() == '2') {
                        $(this).text("未通过")
                    }
                })
            }
            , skin: 'line' //表格风格
            , even: true
            , loading: true
            , page: true //是否显示分页
            , limits: [5, 7, 10]
            , limit: 5 //每页默认显示的数量
        };
        if (level == '0') {
            datagrid.cols[0].push({field:'', fixed: 'right', title: '操作', toolbar: '#barDemo'});
        }

        datagrid = table.render(datagrid);

        table.on('tool(demoEvent)', function(obj){
            var data = obj.data;
            var layEvent = obj.event;
            if(layEvent === 'edit'){
                var index = layer.open({
                    type: 2,
                    title: '修改提现申请状态',
                    closeBtn: 1,
                    area: ['300px', '400px'],
                    shadeClose: true,
                    btn: ['确认'],
                    skin: 'demo layui-layer-rim',
                    content: "update_withdraw.html",
                    // content: "update_status.html",
                    // content: $('#switchTpl').html(),
                    yes: function (index, layero) {
                        console.info($('#statusSelect').val());
                        console.info("---------------");
                        $.ajax({
                            // url: "http://localhost:8119/merchant/updateWithdraw",
                            url: "http://47.98.40.106:8119/merchant/updateWithdraw",
                            data: {
                                "rsid": localStorage.getItem("rsid"),
                                "id": data.id,
                                "status": $('#statusSelect').val()
                            },
                            type: 'post',
                            dataType: 'json',
                            timeout: 1000,
                            success: function (data, status) {
                                if(data.status === '10000') {
                                    parent.location.href ="../../login.html";
                                }
                                layer.msg(data.msg);
                                datagrid.reload({
                                    where:{
                                        rsid: localStorage.getItem("rsid"),
                                        start: $("#start").val(),
                                        end: $("#end").val(),
                                        extract: $("#extract").val(),
                                        status: $("#status").val()
                                    }
                                });
                            },
                            fail: function (err, status) {
                                layer.alert(data.msg);
                            }
                        });
                        layer.close(index); //如果设定了yes回调，需进行手工关闭
                    }
                });
            }
        });

    });

    // 重新载入表格
    $(".query").on("click",function() {
        //刷新表格
        datagrid.reload({
            where:{
                rsid: localStorage.getItem("rsid"),
                start: $("#start").val(),
                end: $("#end").val(),
                extract: $("#extract").val(),
                status: $("#status").val(),
                type: $("#type").val()
            }
        });
    });

</script>
</body>
</html>