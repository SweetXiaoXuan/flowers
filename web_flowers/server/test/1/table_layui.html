<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="../../assets/layui/css/layui.css">
    <link rel="stylesheet" href="../../assets/css/view.css"/>
    <title></title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../assets/css/login.css">
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="../../assets/laydate/laydate.js"></script> <!-- 改成你的路径 -->
    <link rel="icon" href="/favicon.ico">
</head>
<body class="layui-view-body">
<div class="layui-content">
    <div class="layui-row">
        <div class="layui-card">
            <div class="layui-card-body">
                <div class="form-box">
                    <div class="layui-form layui-form-item">
                        <div class="layui-inline">
                            <div class="layui-form-mid">开始时间:</div>
                            <div class="layui-input-inline" style="width: 150px;">
                                <input type="text" autocomplete="off" class="layui-input" id="start" placeholder="yyyy-MM-dd">
                            </div>

                            <div class="layui-form-mid">结束时间:</div>
                            <div class="layui-input-inline" style="width: 150px;">
                                <input type="text" autocomplete="off" class="layui-input" id="end" placeholder="yyyy-MM-dd">
                            </div>

                            <div class="layui-form-mid">提取方式:</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <select name="extract" id="extract">
                                    <option value=""></option>
                                    <option value="0">支付宝</option>
                                    <option value="1">微信</option>
                                    <option value="2">银联</option>
                                </select>
                            </div>
                            <div class="layui-form-mid">提取状态:</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <select name="status" id="status">
                                    <option value=""></option>
                                    <option value="0">待审核</option>
                                    <option value="1">已提取</option>
                                    <option value="2">未通过</option>
                                </select>
                            </div>
                            <button class="layui-btn layui-btn-blue query">查询</button>
                            <button class="layui-btn layui-btn-primary">重置</button>
                        </div>
                    </div>
                    <table id="demo" class="layui-hide"  lay-filter="demo"> </table>
                    <script type="text/html" id="toolbarDemo">
                        <div class="layui-btn-container">
                            <button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中行数据</button>
                            <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>
                            <button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>
                        </div>
                    </script>

                    <script type="text/html" id="barDemo">
                        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
                        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
                    </script>


                </div>
            </div>
        </div>
    </div>
</div>
<script src="../../assets/layui/layui.all.js"></script>
<script>
    laydate.render({
        elem: '#start' //指定元素
        ,showBottom: false
    });
    laydate.render({
        elem: '#end' //指定元素
        ,showBottom: false
    });
    var datagrid;
    layui.use('table', function() {
        var element = layui.element;
        var table = layui.table;
        var form = layui.form;
        datagrid = table.render({
            elem: '#demo'
            ,toolbar: '#toolbarDemo'
            , where:{"rsid": localStorage.getItem("rsid")}
            // , url: 'http://localhost:8119/merchant/withdrawList'
            , url: 'http://47.98.40.106:8119/merchant/withdrawList'
            ,parseData: function(res){
                return {
                    "code": res.status,
                    "msg": res.msg,
                    "count": res.count,
                    "data": res.body.item
                };
            }
            ,dataType:"json"
            , cols: [[
                {type: 'checkbox', fixed: 'left'}
                , {field: 'id', title: 'ID', width: 80, sort: true}
                , {field: 'price', title: '提取金额', minWidth: 50}
                , {field: 'extract', title: '提取方式', minWidth: 60}
                , {field: 'account', title: '提取账号', minWidth: 160}
                , {field: 'arrival', title: '到账方式', minWidth: 160}
                , {field: 'insertTime', title: '提取时间', minWidth: 160}
                , {field: 'remarks', title: '备注', minWidth: 160}
                , {field: 'status', title: '申请状态', minWidth: 160}
                , {field: 'merchantName', title: '商户名', minWidth: 160}
                ,{fixed: 'right', title:'操作', toolbar: '#barDemo', width:150}
            ]]
            ,done: function(res, curr, count){
                var status = res.code;
                if(status === '10000') {
                    parent.location.href ="../../login.html";
                }
                $("[data-field='extract']").children().each(function(){
                    if($(this).text()=='0'){
                        $(this).text("支付宝")
                    }else if($(this).text()=='1'){
                        $(this).text("微信")
                    }else if($(this).text()=='2'){
                        $(this).text("银联")
                    }
                })
                $("[data-field='arrival']").children().each(function(){
                    if($(this).text()=='0'){
                        $(this).text("快速到账")
                    }else if($(this).text()=='1'){
                        $(this).text("正常到账")
                    }
                })
                $("[data-field='status']").children().each(function(){
                    if($(this).text()=='0'){
                        $(this).text("待审核")
                    }else if($(this).text()=='1'){
                        $(this).text("已提取")
                    }else if($(this).text()=='2'){
                        $(this).text("未通过")
                    }
                })

                var level = localStorage.getItem("level");
            }
            , skin: 'line' //表格风格
            ,even: true
            ,loading:true
            , page: true //是否显示分页
            ,limits: [5, 7, 10]
            ,limit: 5 //每页默认显示的数量
        });

        //头工具栏事件
        table.on('toolbar(demo)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            switch(obj.event){
                case 'getCheckData':
                    var data = checkStatus.data;
                    layer.alert(JSON.stringify(data));
                    break;
                case 'getCheckLength':
                    var data = checkStatus.data;
                    layer.msg('选中了：'+ data.length + ' 个');
                    break;
                case 'isAll':
                    layer.msg(checkStatus.isAll ? '全选': '未全选');
                    break;
            };
        });

        //监听行工具事件
        table.on('tool(demo)', function(obj){
            var data = obj.data;
            //console.log(obj)
            if(obj.event === 'del'){
                layer.confirm('真的删除行么', function(index){
                    obj.del();
                    layer.close(index);
                });
            } else if(obj.event === 'edit'){
                layer.prompt({
                    formType: 2
                    ,value: data.status
                }, function(value, index){
                    obj.update({
                        status: value
                    });
                    layer.close(index);
                });
            }
        });
    });



    $(".query").on("click",function()
    {
        //刷新表格
        datagrid.reload(
            {
                where:
                    {
                        rsid: localStorage.getItem("rsid"),
                        start: $("#start").val(),
                        end: $("#end").val(),
                        extract: $("#extract").val(),
                        status: $("#status").val()
                    }
            });
    });
</script>
</body>
</html>