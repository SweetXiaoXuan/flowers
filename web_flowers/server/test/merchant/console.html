<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="../../assets/layui/css/layui.css">
    <link rel="stylesheet" href="../../assets/css/view.css"/>
    <title></title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../assets/css/login.css">
    <link rel="stylesheet" href="../../assets/layui/css/layui.css">
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="../../assets/laydate/laydate.js"></script> <!-- 改成你的路径 -->
    <script src="../../assets/layui/layui.all.js"></script>
    <script src="../../js/console.js"></script>
    <style type="text/css" >
        /*#switchTpl{overflow:visible;}*/

        td[data-field='status'] .layui-table-cell{
            overflow: visible;

        }
        .layui-table-body{
            overflow: visible;
        }
        .layui-table-box,.layui-table-view{
            overflow: visible;
        }

    </style>
    <link rel="icon" href="/favicon.ico">
</head>

<body class="layui-view-body">
    <div class="layui-content">
        <div class="layui-row layui-col-space20">
            <div class="layui-col-sm6 layui-col-md3">
                <div class="layui-card">
                    <div class="layui-card-body chart-card">
                        <div class="chart-header">
                            <div class="metawrap">
                                <div class="meta">
                                    <span  style="font-size: 18px;">佣金总额</span>
                                </div>
                                <div class="total all" style="height: 100px; margin-top: 20px">0.00元</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-sm6 layui-col-md3">
                <div class="layui-card">
                    <div class="layui-card-body chart-card">
                        <div class="chart-header">
                            <div class="metawrap">
                                <div class="meta">
                                    <span style="font-size: 18px;">已提取佣金</span>
                                </div>
                                <div class="total already" style="height: 100px; margin-top: 20px">0.00元</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-sm6 layui-col-md3">
                <div class="layui-card">
                    <div class="layui-card-body chart-card">
                        <div class="chart-header">
                            <div class="metawrap">
                                <div class="meta">
                                    <span style="font-size: 18px;">可提取佣金</span>
                                </div>
                                <div class="total can" style="height: 100px; margin-top: 20px">0.00元</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-sm6 layui-col-md3">
                <div class="meta" style="margin: 50px 0px 0px 80px; color: #1E9FFF">
                    <button type="button" class="login-button" style="font-size: 24px; height: 50px; width: 150px;" onclick="withdraw()">佣金提取</button>
                </div>
            </div>
        </div>
    </div>
    <script>
     var element = layui.element;
     function withdraw() {
             window.location.href ="../../views/withdraw.html";
     }
    </script>



    <div class="layui-content">
        <div class="layui-row">
            <div class="layui-card">
                <div class="layui-card-body">
                    <div class="form-box">
                        <div class="layui-form layui-form-item">
                            <div class="layui-inline">
                                <div class="layui-form-mid">开始时间:</div>
                                <div class="layui-input-inline" style="width: 150px;">
                                    <input type="text" autocomplete="off" class="layui-input" id="start" placeholder="yyyy-MM-dd">
                                </div>

                                <div class="layui-form-mid">结束时间:</div>
                                <div class="layui-input-inline" style="width: 150px;">
                                    <input type="text" autocomplete="off" class="layui-input" id="end" placeholder="yyyy-MM-dd">
                                </div>

                                <div class="layui-form-mid">提取方式:</div>
                                <div class="layui-input-inline" style="width: 100px;">
                                    <select name="extract" id="extract">
                                        <option value=""></option>
                                        <option value="0">支付宝</option>
                                        <option value="1">微信</option>
                                        <option value="2">银联</option>
                                    </select>
                                </div>
                                <div class="layui-form-mid">提取状态:</div>
                                <div class="layui-input-inline" style="width: 100px;">
                                    <select name="status" id="status">
                                        <option value=""></option>
                                        <option value="0">待审核</option>
                                        <option value="1">已提取</option>
                                        <option value="2">未通过</option>
                                    </select>
                                </div>
                                <button class="layui-btn layui-btn-blue query">查询</button>
                                <button type="reset" class="layui-btn layui-btn-primary" onclick="nameClean()">重置</button>
                            </div>

                        </div>
                        <table id="demo" lay-filter="demoEvent"> </table>

                        <!--<script type="text/html" id="toolbarDemo">-->
                            <!--<div class="layui-btn-container">-->
                                <!--<button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中行数据</button>-->
                                <!--<button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>-->
                                <!--<button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>-->
                            <!--</div>-->
                        <!--</script>-->
                        <script type="text/html" id="barDemo">
                            <a class="layui-btn layui-btn-xs withdrawUpdate" lay-event="edit">编辑</a>
                            <!--<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>-->
                        </script>


                        <div class="layui-input-block" id="switchTpl">
                            <select name="statusSelect" lay-verify="required" class="statusSelect">
                                <option value=""></option>
                                <option value="0">待审核</option>
                                <option value="1">已提取</option>
                                <option value="2">未通过</option>
                            </select>
                        </div>

                        <!--<script type="textml" id="switchTpl" >-->
                            <!--<select name="city" lay-verify="required" id="statusSelect">-->
                                <!--<option value=""></option>-->
                                <!--<option value="0">待审核</option>-->
                                <!--<option value="merchant">已提取</option>-->
                                <!--<option value="2">未通过</option>-->
                            <!--<select>-->
                        <!--</script>-->

                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>


        function nameClean() {
            $('#merchantName').val('');
        }


        var level = localStorage.getItem("level");

        laydate.render({
            elem: '#start' //指定元素
            ,showBottom: false
        });
        laydate.render({
            elem: '#end' //指定元素
            ,showBottom: false
        });
        var datagrid;
        layui.use('table', function() {
            var element = layui.element;
            var table = layui.table;
            var form = layui.form;
            datagrid = table.render({
                elem: '#demo'
                // ,toolbar: '#toolbarDemo'
                , where: {"rsid": localStorage.getItem("rsid")}
                // , url: 'http://localhost:8119/merchant/withdrawList'
                , url: 'http://47.98.40.106:8119/merchant/withdrawList'
                , parseData: function (res) {
                    return {
                        "code": res.status,
                        "msg": res.msg,
                        "count": res.count,
                        "data": res.body.item
                    };
                }
                , dataType: "json"
                , cols: [[
                    // {type: 'checkbox', fixed: 'left'}
                     {field: 'id', title: 'ID', width: 20, sort: true}
                    , {field: 'price', title: '提取金额', minWidth: 30}
                    , {field: 'extract', title: '提取方式', minWidth: 30}
                    , {field: 'account', title: '提取账号', minWidth: 30}
                    , {field: 'arrival', title: '到账方式', minWidth: 30}
                    , {field: 'insertTime', title: '提取时间', minWidth: 30}
                    , {field: 'remarks', title: '备注', minWidth: 30}
                    , {field: 'status', title: '申请状态', /*templet: '#switchTpl',*/ unresize: true, minWidth: 12/*, event: 'setSign', style:'cursor: pointer;'*/}
                    , {field: 'merchantName', title: '商户名', minWidth: 30}
                    ,{fixed: 'right', title:'操作', toolbar: '#barDemo', width:30}

                ]]
                , done: function (res, curr, count) {
                    var status = res.code;
                    if (status === '10000') {
                        parent.location.href = "../../login.html";
                    }
                    $("[data-field='extract']").children().each(function () {
                        if ($(this).text() == '0') {
                            $(this).text("支付宝")
                        } else if ($(this).text() == '1') {
                            $(this).text("微信")
                        } else if ($(this).text() == '2') {
                            $(this).text("银联")
                        }
                    })
                    $("[data-field='arrival']").children().each(function () {
                        if ($(this).text() == '0') {
                            $(this).text("快速到账")
                        } else if ($(this).text() == '1') {
                            $(this).text("正常到账")
                        }
                    })
                    $("[data-field='status']").children().each(function () {
                        if ($(this).text() == '0') {
                            $(this).text("待审核")
                            $("#statusSelect option[value='0']").attr('selected',true);
                        } else if ($(this).text() == '1') {
                            $(this).text("已提取")
                        } else if ($(this).text() == '2') {
                            $(this).text("未通过")
                        }
                        // $("#statusSelect option[value='" + dataStatus + "']").attr('selected',true);
                    })
                    // 隐藏列
                    // $(".layui-table-box").find("[data-field='PM_CODE']").css("display","none");
                }
                , skin: 'line' //表格风格
                , even: true
                , loading: true
                , page: true //是否显示分页
                , limits: [5, 7, 10]
                , limit: 5 //每页默认显示的数量
            });

            table.on('toolbar(demo)', function(obj){
                var checkStatus = table.checkStatus(obj.config.id);
                switch(obj.event){
                    case 'getCheckData':
                        var data = checkStatus.data;
                        layer.alert(JSON.stringify(data));
                        break;
                    case 'getCheckLength':
                        var data = checkStatus.data;
                        layer.msg('选中了：'+ data.length + ' 个');
                        break;
                    case 'isAll':
                        layer.msg(checkStatus.isAll ? '全选': '未全选');
                        break;
                };
            });


            //监听操作
            // if (level === 0) {
            //     form.on('switch(select)', function (obj) {
            //         layer.tips(this.value + ' ' + this.name + '：' + obj.elem.checked, obj.othis);
            //     });
            // }



            // //监听单元格事件
            // table.on('tool(demoEvent)', function(obj){
            //     var data = obj.data;
            //     if(obj.event === 'setSign'){
            //         layer.prompt({
            //             formType: 2
            //             ,title: '修改 ID 为 ['+ data.id +'] 的提现申请状态'
            //             ,value: data.sign
            //         }, function(value, index){
            //             layer.close(index);
            //
            //             //这里一般是发送修改的Ajax请求
            //
            //             //同步更新表格和缓存对应的值
            //             obj.update({
            //                 sign: value
            //             });
            //         });
            //     }
            // });
            //  监听行工具事件
            // table.on('tool(demo)', function(obj){
            //     var data = obj.data;
            //     console.log(obj);
            //     if(obj.event === 'del'){
            //         layer.confirm('真的删除行么', function(index){
            //             obj.del();
            //             layer.close(index);
            //         });
            //     } else if(obj.event === 'edit'){
            //         layer.prompt({
            //             formType: 2
            //             ,value: data.status
            //         }, function(value, index){
            //             obj.update({
            //                 status: value
            //             });
            //             layer.close(index);
            //         });
            //     }
            // });
        });

        // $(".withdrawUpdate").on("click",function() {
        //     var $ = layui.$, active = {
        //         getCheckData: function () { //获取选中数据
        //             var checkStatus = table.checkStatus('demo')
        //                 , data = checkStatus.data;
        //             layer.alert(JSON.stringify(data));
        //         }
        //     };
        // });

        $("body").on("click",".withdrawUpdate",function(){
            // layer.prompt(function(val, index){
            //     layer.msg('得到了'+val);
            //     layer.close(index);
            // });

            var index = layer.open({
                type: 1,
                title: '修改提现申请状态',
                closeBtn: 1,
                area: ['300px', '200px'],
                shadeClose: true,
                btn: ['yes'],
                // maxWidth:60,
                // maxHeight:50,
                skin: 'demo layui-layer-rim',
                // content: ['内容', '#switchTpl']
                content: $('#switchTpl').html(),
                yes: function(index, layero){
                    $.ajax({
                        url: localhost_index + "/merchantCommission",
                        data: {
                            "rsid": localStorage.getItem("rsid"),
                            "id":localStorage.getItem("id"),
                            "status": localStorage.getItem("status")
                        },
                        type: 'post',
                        dataType: 'json',
                        timeout: 1000,
                        success: function (data, status) {
                            if(data.status === '10000') {
                                parent.location.href ="../../login.html";
                            }
                            layer.alert(data.msg);
                        },
                        fail: function (err, status) {
                            layer.alert(data.msg);
                        }
                    })




                    //do something
                    layer.close(index); //如果设定了yes回调，需进行手工关闭
                }
            });

            // var index = layui.layer.open({
            //     title : "修改提现申请状态",
            //     type : 2,
            //     content : '修改------------',
            //     success : function(layero, index){
            //         setTimeout(function(){
            //             layui.layer.tips('点击此处返回模板列表', '.layui-layer-setwin .layui-layer-close', {
            //                 tips: 3
            //             });
            //         },500)
            //     },end: function () {
            //         location.reload();
            //     }
            // })
            //改变窗口大小时，重置弹窗的高度，防止超出可视区域（如F12调出debug的操作）
            // $(window).resize(function(){
            //     layui.layer.full(index);
            // })
            // layui.layer.full(index);
        })

        // 重新载入表格
        $(".query").on("click",function() {
            //刷新表格
            datagrid.reload({
                where:{
                    rsid: localStorage.getItem("rsid"),
                    start: $("#start").val(),
                    end: $("#end").val(),
                    extract: $("#extract").val(),
                    status: $("#status").val()
                }
            });
        });




        // 点击行勾选复选框
        // $(document).on("click",".layui-table-body table.layui-table tbody tr", function () {
        //     var index = $(this).attr('data-index');
        //     var tableBox = $(this).parents('.layui-table-box');
        //     //存在固定列
        //     if (tableBox.find(".layui-table-fixed.layui-table-fixed-l").length>0) {
        //         tableDiv = tableBox.find(".layui-table-fixed.layui-table-fixed-l");
        //     } else {
        //         tableDiv = tableBox.find(".layui-table-body.layui-table-main");
        //     }
        //     var checkCell = tableDiv.find("tr[data-index=" + index + "]").find("td div.laytable-cell-checkbox div.layui-form-checkbox I");
        //     if (checkCell.length>0) {
        //         checkCell.click();
        //     }
        // });
        //
        // $(document).on("click", "td div.laytable-cell-checkbox div.layui-form-checkbox", function (e) {
        //     e.stopPropagation();
        // });

    </script>
</body>
</html>