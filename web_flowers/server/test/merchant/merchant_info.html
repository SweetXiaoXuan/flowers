<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../assets/layui/css/layui.css">
    <link rel="stylesheet" href="../../assets/css/view.css"/>
    <link rel="icon" href="/favicon.ico">
    <title>管理后台</title>
</head>
<body class="layui-view-body">
<div class="layui-content">
    <div class="layui-row">
        <div class="layui-card">
            <div class="layui-card-body">
                <div class="form-box">
                    <div class="layui-form layui-form-item">
                        <div class="layui-inline">
                            <div class="layui-form-item">
                                <label class="layui-form-label">商户名</label>
                                <input type="text" name="title" required  lay-verify="required" placeholder="请输入商户名" autocomplete="off" class="layui-input merchantName">
                                <!--<label class="layui-form-label merchantName"></label>-->
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">密码</label>
                                <label class="layui-form-label password"></label>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">商户地址</label>
                                <label class="layui-form-label address"></label>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">老板姓名</label>
                                <label class="layui-form-label bossName"></label>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">联系电话</label>
                                <label class="layui-form-label telephone"></label>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">银行卡号</label>
                                <label class="layui-form-label bankNumber"></label>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">佣金比例</label>
                                <label class="layui-form-label commissionRate"></label>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">营业执照</label>
                                <label class="layui-form-label businessLicense">

                                </label>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">营业执照批号</label>
                                <label class="layui-form-label businessLicenseNumber"></label>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">身份证号</label>
                                <label class="layui-form-label idnumber"></label>
                            </div>
                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label">备注</label>
                                <label class="layui-form-label subtopic"></label>
                            </div>
                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label">添加时间</label>
                                <label class="layui-form-label insertTime"></label>
                            </div>
                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label">等级</label>
                                <label class="layui-form-label level"></label>
                            </div>
                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label">二维码</label>
                                <label class="layui-form-label qccode"></label>
                            </div>
                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label">是否锁定</label>
                                <label class="layui-form-label delete"></label>
                            </div>
                            <button class="layui-btn layui-btn-blue" onclick="updateInfo()">确认</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../../assets/layui/layui.all.js"></script>
<script src="../../assets/jquery-1.7.1.min.js"></script>
<script>
    var data;
    $(document).ready(function() {
        data = JSON.parse(sessionStorage.allmessage);
        $('.merchantName').val(data.merchantName);
        $('.password').append(data.password);
        $('.businessLicense').html(" <img src='" + data.businessLicense + "' height='100' width='100' />");
        $('.businessLicenseNumber').append(data.businessLicenseNumber);
        $('.address').append(data.address);
        $('.bossName').append(data.bossName);
        $('.idnumber').append(data.idnumber);
        $('.telephone').append(data.telephone);
        $('.bankNumber').append(data.bankNumber);
        $('.commissionRate').append(data.commissionRate);
        $('.subtopic').append(data.subtopic);
        $('.level').append(data.level === 0 ? "管理员" : "普通商户");
        var qccode = data.qccode;
        if (isEmpty(qccode)) {
            $('.qccode').html('无');
        } else {
            $('.qccode').html("<a href='" + qccode + "'>" + qccode + "</a>");
        }
        $('.insertTime').append(data.insertTime);
        $('.delete').append(data.delete === 0 ? "解锁" : "锁定");

    });
    
    function updateInfo() {
        $.ajax({
            // url: "http://localhost:8119/merchant/merchant",
            url: "http://47.98.40.106:8119/merchant/merchant",
            data: {
                "rsid": localStorage.getItem("rsid"),
                "id": data.id,
                "type": "update",
                "merchantName": $('.merchantName').val(),
                "password": $('.password').val(),
                "businessLicense": $('.businessLicense').val(),
                "businessLicenseNumber": $('.businessLicenseNumber').val(),
                "address": $('.address').val(),
                "bossName": $('.bossName').val(),
                "idnumber": $('.idnumber').val(),
                "telephone": $('.telephone').val(),
                "bankNumber": $('.bankNumber').val(),
                "level": $('.level').val(),
                "qccode": $('.qccode').val(),
                "insertTime": $('.insertTime').val(),
                "delete": $('.delete').val(),
                "commissionRate": $('.commissionRate').val(),
                "subtopic": $('.subtopic').val()
            },
            type: 'post',
            dataType: 'json',
            timeout: 1000,
            success: function (data, status) {
                if(data.status === '10000') {
                    parent.location.href ="../../login.html";
                } else if(data.status === '1') {
                    layer.msg(data.msg);
                }
                layer.msg(data.msg);
                window.location.reload();
                sessionStorage.clear();
            },
            fail: function (err, status) {
                layer.alert(data.msg);
            }
        });
    }

    function isEmpty(obj) {
        if (obj == null || "".eq(obj) || "undefined".eq(obj) || "null".eq(obj)) return true;
        return false;
    }
</script>
</body>
</html>