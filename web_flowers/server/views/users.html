<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../assets/layui/css/layui.css">
    <link rel="stylesheet" href="../assets/css/view.css"/>
    <link rel="icon" href="/favicon.ico">
    <title>管理后台</title>
</head>
<body class="layui-view-body">
<div class="layui-content">
    <div class="layui-page-header">
        <div class="pagewrap">
                <span class="layui-breadcrumb">
                  <a href="">首页</a>
                  <a href="">用户</a>
                  <a><cite>用户列表</cite></a>
                </span>
            <h2 class="title">用户列表</h2>
        </div>
    </div>
    <div class="layui-row">
        <div class="layui-card">
            <div class="layui-card-body">
                <div class="form-box">
                    <div class="layui-form layui-form-item">
                        <div class="layui-inline">
                            <div class="layui-form-mid">用户名:</div>
                            <div class="layui-input-inline" style="width: 200px;">
                                <input type="text" autocomplete="off" class="layui-input" id="username">
                            </div>
                            <div class="layui-form-mid">手机号:</div>
                            <div class="layui-input-inline" style="width: 120px;">
                                <input type="text" autocomplete="off" class="layui-input" id="mobile">
                            </div>
                            <div class="layui-form-mid">性别:</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <select name="gender" id="gender">
                                    <option value=""></option>
                                    <option value="0">未知</option>
                                    <option value="1">男</option>
                                    <option value="2">女</option>
                                </select>
                            </div>
                            <div class="layui-form-mid">用户等级:</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <select name="user_level" id="user_level">
                                    <option value=""></option>
                                    <option value="0">普通用户</option>
                                    <option value="1">VIP用户</option>
                                    <option value="2">高级VIP用户</option>
                                </select>
                            </div>
                            <div class="layui-form-mid">账号状态:</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <select name="status" id="status">
                                    <option value=""></option>
                                    <option value="0">可用</option>
                                    <option value="1">禁用</option>
                                    <option value="2">注销</option>
                                </select>
                            </div>
                            <br>
                            <br>
                            <div class="layui-form-mid">身份证ocr:</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <select name="is_auth" id="is_auth">
                                    <option value=""></option>
                                    <option value="0">未认证</option>
                                    <option value="1">已认证</option>
                                </select>
                            </div>
                            <div class="layui-form-mid">银行卡绑定:</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <select name="is_bank" id="is_bank">
                                    <option value=""></option>
                                    <option value="0">未认证</option>
                                    <option value="1">已认证</option>
                                </select>
                            </div>
                            <button class="layui-btn layui-btn-blue query">查询</button>
                            <button type="reset" class="layui-btn layui-btn-primary" onclick="nameClean()">重置</button>
                        </div>
                    </div>
                    <table id="demo" lay-filter="demoEvent"></table>
                    <script type="text/html" id="barDemo">
                        <button class="layui-btn layui-btn-xs withdrawUpdate" id="withdrawUpdate" lay-event="edit" >查看</button>
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/layui/layui.all.js"></script>
<script src="../assets/jquery-1.7.1.min.js"></script>
<script>

    function nameClean() {
        $('#username').val('');
        $('#mobile').val('');
    }

    var datagrid;
    layui.use('table', function() {
        var element = layui.element;
        var table = layui.table;
        var form = layui.form;
        datagrid = table.render({
            elem: '#demo'
            ,where:
                {
                    rsid: localStorage.getItem("rsid"),
                    username : $("#username").val(),
                    mobile : $("#mobile").val(),
                    gender : $("#gender").val(),
                    user_level : $("#user_level").val(),
                    status : $("#status").val(),
                    is_auth : $("#is_auth").val(),
                    is_bank : $("#is_bank").val()
                }
            , url: 'http://localhost:8119/merchant/users'
            // , url: 'http://47.98.40.106:8119/merchant/users'
            ,parseData: function(res){
                return {
                    "code": res.status,
                    "msg": res.msg,
                    "count": res.count,
                    "data": res.body.item
                };
            }
            ,dataType:"json"
            , cols: [[
                {field: 'id', title: 'ID',  sort: true}
                , {field: 'username', title: '用户名'}
                , {field: 'mobile', title: '手机号', width: 130}
                , {field: 'gender', title: ' 性别'}
                , {field: 'user_level', title: '用户等级'}
                , {field: 'status', title: '账号状态'}
                , {field: 'lastLoginTime', title: '上次登陆时间', width: 200}
                , {field: 'merchant_name', title: '商户名'}
                , {field:'', fixed: 'right', title: '操作', toolbar: '#barDemo'}
            ]]
            ,done: function(res){
                var status = res.code;
                if(status === '10000') {
                    parent.location.href ="../../login.html";
                }
                $("[data-field='gender']").children().each(function () {
                    if ($(this).text() === '0') {
                        $(this).text("未知")
                    } else if ($(this).text() === '1') {
                        $(this).text("男")
                    } else if ($(this).text() === '2') {
                        $(this).text("女")
                    }
                })
                $("[data-field='user_level']").children().each(function () {
                    if ($(this).text() === '0') {
                        $(this).text("普通用户")
                    } else if ($(this).text() === '1') {
                        $(this).text("VIP用户")
                    } else if ($(this).text() === '2') {
                        $(this).text("高级VIP用户")
                    }
                })
                $("[data-field='status']").children().each(function () {
                    if ($(this).text() === '0') {
                        $(this).text("可用")
                    } else if ($(this).text() === '1') {
                        $(this).text("禁用")
                    } else if ($(this).text() === '2') {
                        $(this).text("注销")
                    }
                })
            }
            , skin: 'line' //表格风格
            ,loading:true
            ,even: true
            , page: true //是否显示分页
            ,limits: [5, 7, 10]
            ,limit: 5 //每页默认显示的数量
        });

        table.on('tool(demoEvent)', function(obj){
            data = obj.data;
            sessionStorage.allmessage = JSON.stringify(data);
            var layEvent = obj.event;
            if(layEvent === 'edit') {
                var index = layer.open({
                    type: 2,
                    title: '查询用户信息',
                    closeBtn: 1,
                    area: ['550px', '500px'],
                    shadeClose: true,
                    skin: 'demo layui-layer-rim',
                    content: 'user_info.html'
                });
            }
        });
    });


    $(".query").on("click",function()
    {
        //刷新表格
        datagrid.reload(
            {
                where:
                    {
                        rsid: localStorage.getItem("rsid"),
                        username: $("#username").val(),
                        mobile : $("#mobile").val(),
                        gender : $("#gender").val(),
                        user_level : $("#user_level").val(),
                        status : $("#status").val(),
                        is_auth : $("#is_auth").val(),
                        is_bank : $("#is_bank").val()
                    }
            });
    });
</script>
</body>
</html>